var isWebPSupported,viewer,pageNo,isScrolling,newDim,throttleTimeout,pdfPages,bookPageCount,bookTitle,currentTitleIndex,pageIndex=0,arrDim=[],sumHeight=0,isLocalHost=""==location.host;function checkWebPSupport(e){var o=new Image;o.onload=function(){isWebPSupported=o.width>0&&o.height>0,e&&e()},o.onerror=function(){isWebPSupported=!1,e&&e()},o.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA"}function expandRepeat(e){if(e.indexOf("(")>-1)for(var o=0;o<=3;o++)e=(e=e.replace(RegExp(`\\|${o}\\((\\d*?)\\)`,"g"),function(e,t){return`|${o}`.repeat(t)})).replace(RegExp(`-${o}\\((\\d*?)\\)`,"g"),function(e,t){return`-${o}`.repeat(t)});return e.replace(/-/g,"|-").replace(/\|/g," ").trim().split(" ")}function getRatio(e,o,t,i){return t/e}function resize(e,o,t,i){var n=Math.min(getRatio(e,o,t,i),1);return{width:n*e,height:n*o}}function onPageNoBlur(e){var o=+e.value,t=pageIndex+1;o!=t&&o>0&&o<=bookPageCount+1?gotoPage(o):e.value=t,viewer.css("overflow","scroll")}function onPageNoFocus(e){viewer.css("overflow","hidden")}function onPageNoKeyUp(e,o){13==o.keyCode&&(o.preventDefault(),e.blur())}function pdfControls(){var e=booksToc[bookName]?'<img onclick="openToc();" src="svg/list.svg"/>':"";return`<div id='pdfcontrols' class='show'>\n\t<div class="pageNo">\n\t\t<div><input onkeyup="onPageNoKeyUp(this, event);" onfocus="onPageNoFocus(this);" onblur="onPageNoBlur(this);" type="number" value="1">/${bookPageCount+1}</div>\n\t</div>\n\t<div class="title">\n\t\t${bookTitle}\n\t</div>\n\t<div class="controls">\n\t\t${e}\n\t\t<img onclick="window.history.back();closeBook();" src="svg/cross.svg"/>\n\t</div>\n    </div>`}function renderToc(){var e=booksToc[bookName],o="";for(var t in e){o+=`<div onclick='closeToc(${+t+1})' class='tocItem'>${e[t]}</div>`}return`<div id='tocMenu'>\n\t<div class="menu">\n\t\t<div class="title">\n\t\t\t${bookTitle}\n\t\t</div>\n\t\t<div class="toc">\n\t\t\t${o}\n\t\t</div>\n\t</div>\n\t<div onclick="closeToc();" style="flex-grow:1;">\n\t</div>\n    </div>`}function openToc(){$("#tocMenu").addClass("show"),viewer.addClass("overflow-hidden");var e=$(".activeToc");e.length&&e[0].scrollIntoView({block:"center",inline:"start"})}function closeToc(e){viewer.removeClass("overflow-hidden"),e&&gotoPage(e),$("#tocMenu").removeClass("show")}function getWindowWidth(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}function getWindowHeight(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}function toggleControls(){isScrolling||$("#pdfcontrols").toggleClass("show")}function scrollEnd(e){window.scrollPos=viewer.scrollTop(),window.oldPos=(window.scrollPos||0)/sumHeight,isScrolling=!1;for(var o=Math.max(0,pageIndex-1);o<=pageIndex+5&&o<=bookPageCount;o++){var t=pdfPages[o].getAttribute("data-src");if(t&&(pdfPages[o].setAttribute("src",t),pdfPages[o].setAttribute("data-src","")),!((o?arrDim[o-1].ratio:0)*sumHeight-scrollPos<=pageHeight))break}e||(localStorage[bookName]=pageIndex+1)}function binarySearch(e,o,t){for(var i=0,n=e.length-1;i<=n;){var r=Math.floor((i+n)/2),s=e[r],a=e[r+1];if(t&&(s=s[t],a=a[t]),o>=s&&(r==e.length-1||o<a))return r;o>s&&(i=r+1),o<s&&(n=r-1)}return-1}function gotoPage(e){if(e>0&&e<=bookPageCount+1){var o=e-1;return viewer[0].scrollTo(0,0==o?0:arrDim[o-1].ratio*sumHeight+5),!0}return!1}function setTitle(){if(booksToc[bookName]){var e=Object.keys(booksToc[bookName]),o=binarySearch(e,pageIndex);o!=currentTitleIndex&&(currentTitleIndex=o,$(".activeToc").removeClass("activeToc"),-1==o?$("#pdfcontrols .title").html(bookTitle):($("#pdfcontrols .title").html(booksToc[bookName][e[o]]),$(".tocItem").eq(currentTitleIndex).addClass("activeToc")))}}function onBookScroll(){var e=viewer.scrollTop();pageIndex=binarySearch(arrDim,e/sumHeight,"ratio")+1,pageNo.val(pageIndex+1),setTitle(),clearTimeout(throttleTimeout),throttleTimeout=0}function resizeBook(){if(window.isBookOpen){var e=getWindowWidth();if(Math.abs(pageWidth-e)>20){window.pageWidth=e,window.pageHeight=getWindowHeight(),newDim=resize(bookWidth,bookHeight,pageWidth,pageHeight),sumHeight=0;for(var o=0;o<arrDim.length;o++){var t=arrDim[o].width/newDim.width;sumHeight+=arrDim[o].height/t}$("#dimWrapper").css({height:sumHeight+"px",width:newDim.width+"px"}),viewer[0].scrollTo(0,(window.oldPos||0)*sumHeight)}}}function getSortedBooks(){return window.sortedBooks=window.sortedBooks||(window.localStorage.sort||Object.keys(booksList).join("|")).split("|")}function saveBookSortOrder(e){var o=getSortedBooks();o.sort(function(o,t){return o==e?-1:t==e?1:0}),window.localStorage.sort=o.join("|")}function openBook(e,o){saveBookSortOrder(e),currentTitleIndex=null;var t=o.missing=o.missing||{};window.bookName=e,window.bookWidth=o.w,window.bookHeight=o.h;var i=o.ah,n=o.aw,r=expandRepeat(o.hh),s=expandRepeat(o.ww);bookPageCount=o.pageCount,bookTitle=o.title,arrDim=[],pageIndex=0,window.pageWidth=getWindowWidth(),window.pageHeight=getWindowHeight(),newDim=resize(bookWidth,bookHeight,pageWidth,pageHeight);for(var a=0;a<r.length;a++)arrDim.push({width:+s[a]+n,height:+r[a]+i}),0==a&&arrDim.push({width:620,height:877});sumHeight=0;var d;void 0===viewer&&(viewer=$("#pdfviewer")).scroll(function(e){isScrolling=!0,clearTimeout(d),d=setTimeout(scrollEnd,300),throttleTimeout||(throttleTimeout=setTimeout(onBookScroll,250))});var l="",c=[],g=!isLocalHost&&isWebPSupported?"webp":"jpg",h=isLocalHost?"books":isWebPSupported?"https://shriharshanbooksoptimized.pages.dev/":"https://shriharshanbooks.pages.dev/",u=!isLocalHost&&isWebPSupported&&o.folderWebP||e,p=0;for(var w in t)p+=t[w];for(var v=1;v<=bookPageCount-p;v++){var m=t[v]||0;c.push(`${h}/${u}/${e}_${v}.${g}`);for(var f=0;f<m;f++)c.push(`${h}/${u}/${e}_${v}.${f+1}.${g}`);1==v&&c.push(`assets/not_for_sale.${g}`)}for(var b in c){var k=arrDim[b].width/newDim.width;sumHeight+=arrDim[b].newHeight=arrDim[b].height/k}var T=`src='assets/${e}.${isWebPSupported?"webp":"jpg"}'`,P=isMobile.phone||isMobile.tablet;for(var b in c){var H=c[b],W=arrDim[b].newHeight;l+=`<div class='pdfpage' style="flex:${W/sumHeight}"${P?"":` tabindex="${b}"`}>\n    \t\t<img ${T} data-src='${H}'/>\n    \t</div>`,arrDim[b].ratio=b>0?arrDim[b-1].ratio+W/sumHeight:W/sumHeight,T=""}l=`${pdfControls()}<div onclick='toggleControls();'><div id='dimWrapper' oncontextmenu="return false;" style='width:${newDim.width}px;height:${sumHeight}px'>`+l+"</div></div>"+renderToc(),$("nav").css("position","unset"),$("body").css("overflow-y","hidden"),viewer.html(l),pdfPages=$(".pdfpage > img"),viewer.show();var x=+localStorage[e];x>0&&x<=arrDim.length?gotoPage(x):(scrollEnd(!0),viewer.scrollTop(0)),pageNo=$(".pageNo input"),void 0===window.isBookOpen&&window.addEventListener("resize",function(){resizeBook()},!1),window.isBookOpen=!0}function closeBook(){window.isBookOpen&&(window.isBookOpen=!1,$("nav").css("position","sticky"),$("body").css("overflow-y","scroll"),viewer.hide(),viewer.html(""))}checkWebPSupport();