var isWebPSupported,viewer,pageNo,isScrolling,newDim,throttleTimeout,pdfPages,bookPageCount,bookTotalPages,bookTitle,currentTitleIndex,pageIndex=0,arrDim=[],sumHeight=0,isLocalHost=""==location.host;function checkWebPSupport(o){var e=new Image;e.onload=function(){isWebPSupported=e.width>0&&e.height>0,o&&o()},e.onerror=function(){isWebPSupported=!1,o&&o()},e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA"}function expandRepeat(o){if(o.indexOf("(")>-1)for(var e=0;e<=3;e++)o=(o=o.replace(RegExp(`\\|${e}\\((\\d*?)\\)`,"g"),function(o,t){return`|${e}`.repeat(t)})).replace(RegExp(`-${e}\\((\\d*?)\\)`,"g"),function(o,t){return`-${e}`.repeat(t)});return o.replace(/-/g,"|-").replace(/\|/g," ").trim().split(" ")}function getRatio(o,e,t,i){return t/o}function resize(o,e,t,i){var n=Math.min(getRatio(o,e,t,i),1);return{width:n*o,height:n*e}}function onPageNoBlur(o){var e=+o.value,t=pageIndex+1;e!=t&&e>0&&e<=bookPageCount+1?gotoPage(e):o.value=t,viewer.css("overflow","scroll")}function onPageNoFocus(o){viewer.css("overflow","hidden")}function onPageNoKeyUp(o,e){13==e.keyCode&&(e.preventDefault(),o.blur())}function pdfControls(){var o=booksToc[bookName]?'<img onclick="openToc();" src="svg/list.svg"/>':"";return`<div id='pdfcontrols' class='show'>\n\t<div class="pageNo">\n\t\t<div><input onkeyup="onPageNoKeyUp(this, event);" onfocus="onPageNoFocus(this);" onblur="onPageNoBlur(this);" type="number" value="1">/${bookTotalPages+1}</div>\n\t</div>\n\t<div class="title">\n\t\t${bookTitle}\n\t</div>\n\t<div class="controls">\n\t\t${o}\n\t\t<img onclick="window.history.back();closeBook();" src="svg/cross.svg"/>\n\t</div>\n    </div>`}function renderToc(){var o=booksToc[bookName],e="";for(var t in o){e+=`<div onclick='closeToc(${+t+1})' class='tocItem'>${o[t]}</div>`}return`<div id='tocMenu'>\n\t<div class="menu">\n\t\t<div class="title">\n\t\t\t${bookTitle}\n\t\t</div>\n\t\t<div class="toc">\n\t\t\t${e}\n\t\t</div>\n\t</div>\n\t<div onclick="closeToc();" style="flex-grow:1;">\n\t</div>\n    </div>`}function openToc(){}function closeToc(o){viewer.removeClass("overflow-hidden"),o&&gotoPage(o),$("#tocMenu").removeClass("show")}function getWindowWidth(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}function getWindowHeight(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}function toggleControls(){isScrolling||$("#pdfcontrols").toggleClass("show")}function scrollEnd(o){window.scrollPos=viewer.scrollTop(),window.oldPos=(window.scrollPos||0)/sumHeight,isScrolling=!1;for(var e=Math.max(0,pageIndex-1);e<=pageIndex+5&&e<=bookPageCount;e++){var t=pdfPages[e].getAttribute("data-src");if(t&&(pdfPages[e].setAttribute("src",t),pdfPages[e].setAttribute("data-src","")),!((e?arrDim[e-1].ratio:0)*sumHeight-scrollPos<=pageHeight))break}o||(localStorage[bookName]=pageIndex+1)}function binarySearch(o,e,t){for(var i=0,n=o.length-1;i<=n;){var r=Math.floor((i+n)/2),s=o[r],a=o[r+1];if(t&&(s=s[t],a=a[t]),e>=s&&(r==o.length-1||e<a))return r;e>s&&(i=r+1),e<s&&(n=r-1)}return-1}function gotoPage(o){if(o>0&&o<=bookPageCount+1){var e=o-1;return viewer[0].scrollTo(0,0==e?0:arrDim[e-1].ratio*sumHeight+5),!0}return!1}function setTitle(){if(booksToc[bookName]){var o=Object.keys(booksToc[bookName]),e=binarySearch(o,pageIndex);e!=currentTitleIndex&&(currentTitleIndex=e,$(".activeToc").removeClass("activeToc"),-1==e?$("#pdfcontrols .title").html(bookTitle):($("#pdfcontrols .title").html(booksToc[bookName][o[e]]),$(".tocItem").eq(currentTitleIndex).addClass("activeToc")))}}function onBookScroll(){var o=viewer.scrollTop();pageIndex=binarySearch(arrDim,o/sumHeight,"ratio")+1,pageNo.val(pageIndex+1),setTitle(),clearTimeout(throttleTimeout),throttleTimeout=0}function resizeBook(){if(window.isBookOpen){var o=getWindowWidth();if(Math.abs(pageWidth-o)>20){window.pageWidth=o,window.pageHeight=getWindowHeight(),newDim=resize(bookWidth,bookHeight,pageWidth,pageHeight),sumHeight=0;for(var e=0;e<arrDim.length;e++){var t=arrDim[e].width/newDim.width;sumHeight+=arrDim[e].height/t}$("#dimWrapper").css({height:sumHeight+"px",width:newDim.width+"px"}),viewer[0].scrollTo(0,(window.oldPos||0)*sumHeight)}}}function getSortedBooks(){return window.sortedBooks=window.sortedBooks||(window.localStorage.sort||Object.keys(booksList).join("|")).split("|")}function saveBookSortOrder(o){var e=getSortedBooks();e.sort(function(e,t){return e==o?-1:t==o?1:0}),window.localStorage.sort=e.join("|")}function openBook(o,e){saveBookSortOrder(o),currentTitleIndex=null;var t=e.missing=e.missing||{};window.bookName=o,window.bookWidth=e.w,window.bookHeight=e.h;var i=e.ah,n=e.aw,r=expandRepeat(e.hh),s=expandRepeat(e.ww);bookPageCount=e.pageCount,bookTotalPages=e.totalPages,bookTitle=e.title,arrDim=[],pageIndex=0,window.pageWidth=getWindowWidth(),window.pageHeight=getWindowHeight(),newDim=resize(bookWidth,bookHeight,pageWidth,pageHeight);for(var a=0;a<bookPageCount;a++)arrDim.push({width:+s[a]+n,height:+r[a]+i}),0==a&&arrDim.push({width:620,height:877});sumHeight=0;var d;void 0===viewer&&(viewer=$("#pdfviewer")).scroll(function(o){isScrolling=!0,clearTimeout(d),d=setTimeout(scrollEnd,300),throttleTimeout||(throttleTimeout=setTimeout(onBookScroll,250))});var l="",c=[],g=!isLocalHost&&isWebPSupported?"webp":"jpg",u=isLocalHost?"books":isWebPSupported?"https://shriharshanbooksoptimized.pages.dev/":"https://shriharshanbooks.pages.dev/",h=!isLocalHost&&isWebPSupported&&e.folderWebP||o,p=0;for(var w in t)p+=t[w];for(var v=1;v<=bookPageCount-p;v++){var m=t[v]||0;c.push(`${u}/${h}/${o}_${v}.${g}`);for(var f=0;f<m;f++)c.push(`${u}/${h}/${o}_${v}.${f+1}.${g}`);v==bookPageCount-p&&c.push(`assets/not_for_sale.${g}`)}for(var b in c){var k=arrDim[b].width/newDim.width;sumHeight+=arrDim[b].newHeight=arrDim[b].height/k}var T=`src='assets/${o}.${isWebPSupported?"webp":"jpg"}'`,P=isMobile.phone||isMobile.tablet;for(var b in c){var H=c[b],W=arrDim[b].newHeight;l+=`<div class='pdfpage' style="flex:${W/sumHeight}"${P?"":` tabindex="${b}"`}>\n    \t\t<img ${T} data-src='${H}'/>\n    \t</div>`,arrDim[b].ratio=b>0?arrDim[b-1].ratio+W/sumHeight:W/sumHeight,T=""}l=`${pdfControls()}<div onclick='toggleControls();'><div id='dimWrapper' oncontextmenu="return false;" style='width:${newDim.width}px;height:${sumHeight}px'>`+l+"</div></div>"+renderToc(),$("nav").css("position","unset"),$("body").css("overflow-y","hidden"),viewer.html(l),pdfPages=$(".pdfpage > img"),viewer.show();var x=+localStorage[o];x>0&&x<=arrDim.length?gotoPage(x):(scrollEnd(!0),viewer.scrollTop(0)),pageNo=$(".pageNo input"),void 0===window.isBookOpen&&window.addEventListener("resize",function(){resizeBook()},!1),window.isBookOpen=!0}function closeBook(){window.isBookOpen&&(window.isBookOpen=!1,$("nav").css("position","sticky"),$("body").css("overflow-y","scroll"),viewer.hide(),viewer.html(""))}checkWebPSupport();