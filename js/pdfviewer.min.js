var isWebPSupported,viewer,pageNo,isScrolling,newDim,throttleTimeout,pdfPages,bookPageCount,bookTotalPages,bookTitle,currentTitleIndex,pageIndex=0,arrDim=[],sumHeight=0,isLocalHost=""==location.host;function checkWebPSupport(b){var a=new Image;a.onload=function(){isWebPSupported=a.width>0&&a.height>0,b&&b()},a.onerror=function(){isWebPSupported=!1,b&&b()},a.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA"}function expandRepeat(a){if(a.indexOf("(")> -1)for(var b=0;b<=3;b++)a=(a=a.replace(RegExp(`\\|${b}\\((\\d*?)\\)`,"g"),function(c,a){return`|${b}`.repeat(a)})).replace(RegExp(`-${b}\\((\\d*?)\\)`,"g"),function(c,a){return`-${b}`.repeat(a)});return a.replace(/-/g,"|-").replace(/\|/g," ").trim().split(" ")}function getRatio(a,c,b,d){return b/a}function resize(a,b,d,e){var c=Math.min(getRatio(a,b,d,e),1);return{width:c*a,height:c*b}}function onPageNoBlur(b){var a=+b.value,c=pageIndex+1;a!=c&&a>0&&a<=bookPageCount+1?gotoPage(a):b.value=c,viewer.css("overflow","scroll")}function onPageNoFocus(a){viewer.css("overflow","hidden")}function onPageNoKeyUp(b,a){13==a.keyCode&&(a.preventDefault(),b.blur())}function pdfControls(){return`<div id='pdfcontrols' class='show'>
	<div class="pageNo">
		<div><input onkeyup="onPageNoKeyUp(this, event);" onfocus="onPageNoFocus(this);" onblur="onPageNoBlur(this);" type="number" value="1">/${bookTotalPages+1}</div>
	</div>
	<div class="title">
		${bookTitle}
	</div>
	<div class="controls">
		${booksToc[bookName]?'<img onclick="openToc();" src="svg/list.svg"/>':""}
		<img onclick="window.history.back();closeBook();" src="svg/cross.svg"/>
	</div>
    </div>`}function renderToc(){var a=booksToc[bookName],b="";for(var c in a){var d=a[c];b+=`<div onclick='closeToc(${+c+1})' class='tocItem'>${d}</div>`}return`<div id='tocMenu'>
	<div class="menu">
		<div class="title">
			${bookTitle}
		</div>
		<div class="toc">
			${b}
		</div>
	</div>
	<div onclick="closeToc();" style="flex-grow:1;">
	</div>
    </div>`}function openToc(){$("#tocMenu").addClass("show"),viewer.addClass("overflow-hidden");var a=$(".activeToc");a.length&&a[0].scrollIntoView({block:"center",inline:"start"})}function closeToc(a){viewer.removeClass("overflow-hidden"),a&&gotoPage(a),$("#tocMenu").removeClass("show")}function getWindowWidth(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}function getWindowHeight(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}function toggleControls(){isScrolling||$("#pdfcontrols").toggleClass("show")}function scrollEnd(c){window.scrollPos=viewer.scrollTop(),window.oldPos=(window.scrollPos||0)/sumHeight,isScrolling=!1;for(var a=Math.max(0,pageIndex-1);a<=pageIndex+5&&a<=bookPageCount;a++){var b=pdfPages[a].getAttribute("data-src");if(b&&(pdfPages[a].setAttribute("src",b),pdfPages[a].setAttribute("data-src","")),!((a?arrDim[a-1].ratio:0)*sumHeight-scrollPos<=pageHeight))break}c||(localStorage[bookName]=pageIndex+1)}function binarySearch(c,d,e){for(var f=0,g=c.length-1;f<=g;){var a=Math.floor((f+g)/2),b=c[a],h=c[a+1];if(e&&(b=b[e],h=h[e]),d>=b&&(a==c.length-1||d<h))return a;d>b&&(f=a+1),d<b&&(g=a-1)}return -1}function gotoPage(a){if(!(a>0)||!(a<=bookPageCount+1))return!1;var b=a-1;return viewer[0].scrollTo(0,0==b?0:arrDim[b-1].ratio*sumHeight+5),!0}function setTitle(){if(booksToc[bookName]){var b=Object.keys(booksToc[bookName]),a=binarySearch(b,pageIndex);a!=currentTitleIndex&&(currentTitleIndex=a,$(".activeToc").removeClass("activeToc"),-1==a?$("#pdfcontrols .title").html(bookTitle):($("#pdfcontrols .title").html(booksToc[bookName][b[a]]),$(".tocItem").eq(currentTitleIndex).addClass("activeToc")))}}function onBookScroll(){pageIndex=binarySearch(arrDim,viewer.scrollTop()/sumHeight,"ratio")+1,pageNo.val(pageIndex+1),setTitle(),clearTimeout(throttleTimeout),throttleTimeout=0}function resizeBook(){if(window.isBookOpen){var b=getWindowWidth();if(Math.abs(pageWidth-b)>20){window.pageWidth=b,window.pageHeight=getWindowHeight(),newDim=resize(bookWidth,bookHeight,pageWidth,pageHeight),sumHeight=0;for(var a=0;a<arrDim.length;a++){var c=arrDim[a].width/newDim.width;sumHeight+=arrDim[a].height/c}$("#dimWrapper").css({height:sumHeight+"px",width:newDim.width+"px"}),viewer[0].scrollTo(0,(window.oldPos||0)*sumHeight)}}}function getSortedBooks(){return window.sortedBooks=window.sortedBooks||(window.localStorage.sort||Object.keys(booksList).join("|")).split("|")}function saveBookSortOrder(b){var a=getSortedBooks();a.sort(function(a,c){return a==b?-1:c==b?1:0}),window.localStorage.sort=a.join("|")}function openBook(c,a){saveBookSortOrder(c),currentTitleIndex=null;var z,h=a.missing=a.missing||{};window.bookName=c,window.bookWidth=a.w,window.bookHeight=a.h;var r=a.ah,s=a.aw,m={height:expandRepeat(a.hh),width:expandRepeat(a.ww)};bookPageCount=a.pageCount,bookTotalPages=a.totalPages,bookTitle=a.title,arrDim=[],pageIndex=0,window.pageWidth=getWindowWidth(),window.pageHeight=getWindowHeight(),newDim=resize(bookWidth,bookHeight,pageWidth,pageHeight);for(var f=0;f<bookPageCount;f++)arrDim.push({width:+m.width[f]+s,height:+m.height[f]+r}),0==f&&arrDim.push({width:620,height:877});sumHeight=0,void 0===viewer&&(viewer=$("#pdfviewer")).scroll(function(a){isScrolling=!0,clearTimeout(z),z=setTimeout(scrollEnd,300),throttleTimeout||(throttleTimeout=setTimeout(onBookScroll,250))});var g="",d=[],i=!isLocalHost&&isWebPSupported?"webp":"jpg",n=isLocalHost?"books":isWebPSupported?"https://shriharshanbooksoptimized.pages.dev/":"https://shriharshanbooks.pages.dev/",o=!isLocalHost&&isWebPSupported&&a.folderWebP||c,p=0;for(var t in h)p+=h[t];for(var e=1;e<=bookPageCount-p;e++){var u=h[e]||0;d.push(`${n}/${o}/${c}_${e}.${i}`);for(var j=0;j<u;j++)d.push(`${n}/${o}/${c}_${e}.${j+1}.${i}`);1==e&&d.push(`assets/not_for_sale.${i}`)}for(var b in d){var v=arrDim[b].width/newDim.width;sumHeight+=arrDim[b].newHeight=arrDim[b].height/v}var q=`src='assets/${c}.${isWebPSupported?"webp":"jpg"}'`,w=isMobile.phone||isMobile.tablet;for(var b in d){var x=d[b],k=arrDim[b].newHeight,y=w?"":` tabindex="${b}"`;g+=`<div class='pdfpage' style="flex:${k/sumHeight}"${y}>
    		<img ${q} data-src='${x}'/>
    	</div>`,b>0?arrDim[b].ratio=arrDim[b-1].ratio+k/sumHeight:arrDim[b].ratio=k/sumHeight,q=""}g=`${pdfControls()}<div onclick='toggleControls();'><div id='dimWrapper' oncontextmenu="return false;" style='width:${newDim.width}px;height:${sumHeight}px'>`+g+"</div></div>"+renderToc(),$("nav").css("position","unset"),$("body").css("overflow-y","hidden"),viewer.html(g),pdfPages=$(".pdfpage > img"),viewer.show();var l=+localStorage[c];l>0&&l<=arrDim.length?gotoPage(l):(scrollEnd(!0),viewer.scrollTop(0)),pageNo=$(".pageNo input"),void 0===window.isBookOpen&&window.addEventListener("resize",function(){resizeBook()},!1),window.isBookOpen=!0}function closeBook(){window.isBookOpen&&(window.isBookOpen=!1,$("nav").css("position","sticky"),$("body").css("overflow-y","scroll"),viewer.hide(),viewer.html(""))}checkWebPSupport()