var finalDates = {
	'कामदा': {
		type: 'ekadashi',
		date: ['Apr 23, 2021', 'Apr 12, 2022'],
	},
	'बरुथिनी': {
		type: 'ekadashi',
		date: ['May 7, 2021', 'Apr 26, 2022'],
	},
	'मोहिनी': {
		type: 'ekadashi',
		date: ['May 23, 2021', 'May 12, 2022'],
	},
	'अपरा': {
		type: 'ekadashi',
		date: ['Jun 6, 2021', 'May 26, 2022'],
	},
	'निर्जला': {
		type: 'ekadashi',
		date: ['Jun 21, 2021', 'Jun 10, 2022'],
	},
	'योगिनी': {
		type: 'ekadashi',
		date: ['Jul 5, 2021', 'Jun 24, 2022'],
	},
	'हरिशयनी': {
		type: 'ekadashi',
		date: ['Jul 20, 2021', 'Jul 10, 2022'],
	},
	'कामिका': {
		type: 'ekadashi',
		date: ['Aug 4, 2021', 'Jul 24, 2022'],
	},
	'पुण्यदा': {
		type: 'ekadashi',
		date: ['Aug 18, 2021', 'Aug 08, 2022'],
	},
	'अजा': {
		type: 'ekadashi',
		date: ['Sep 3, 2021', 'Aug 23, 2022'],
	},
	'पद्मा': {
		type: 'ekadashi',
		date: ['Sep 17, 2021', 'Sep 06, 2022'],
	},
	'इन्दिरा': {
		type: 'ekadashi',
		date: ['Oct 2, 2021', 'Sep 21, 2022'],
	},
	'पापंकुशा': {
		type: 'ekadashi',
		date: ['Oct 16, 2021', 'Oct 06, 2022'],
	},
	'रमा': {
		type: 'ekadashi',
		date: ['Nov 1, 2021', 'Oct 21, 2022'],
	},
	'प्रबोधिनी': {
		type: 'ekadashi',
		date: ['Nov 15, 2021', 'Nov 04, 2022'],
	},
	'उत्पन्ना': {
		type: 'ekadashi',
		date: ['Nov 30, 2021', 'Nov 20, 2022'],
	},
	'मोक्षदा': {
		type: 'ekadashi',
		date: ['Dec 14, 2021', 'Dec 04, 2022'],
	},
	'सफला': {
		type: 'ekadashi',
		date: ['Dec 30, 2021', 'Dec 19, 2022'],
	},
	'पुत्रदा': {
		type: 'ekadashi',
		date: ['Jan 13, 2022', 'Jan 02, 2023'],
	},
	'षट्तिला': {
		type: 'ekadashi',
		date: ['Jan 28, 2022', 'Jan 18, 2023'],
	},
	'जया': {
		type: 'ekadashi',
		date: ['Feb 12, 2022', 'Feb 01, 2023'],
	},
	'विजया': {
		type: 'ekadashi',
		date: ['Feb 27, 2022', 'Feb 16, 2023'],
	},
	'आमलकी': {
		type: 'ekadashi',
		date: ['Mar 14, 2022', 'Mar 03, 2023'],
	},
	'पापमोचनी': {
		type: 'ekadashi',
		date: ['Mar 28, 2022', 'Mar 18, 2023'],
	},
	'श्री राम नवमी': {
		type: 'utsav',
		date: ['Apr 21, 2021', 'Apr 10, 2022'],
	},
	'पाटोत्सव - अभिषेक <br>(श्री सिद्धि सदन)': {
		type: 'utsav',
		date: ['May 12, 2021', 'May 1, 2022'],
	},
	'राजगद्दी <br>(श्री सिद्धि सदन)': {
		type: 'utsav',
		date: ['May 13, 2021', 'May 2, 2022'],
	},
	'श्री बड़े महाराजजी का भण्डारा': {
		type: 'utsav',
		date: ['May 14, 2021', 'May 3, 2022'],
	},
	'श्री जानकी नवमी': {
		type: 'utsav',
		date: ['May 21, 2021', 'May 10, 2022'],
	},
	'श्री नृसिंह जयंती': {
		type: 'utsav',
		date: ['May 25, 2021', 'May 14, 2022'],
	},
	'पाटोत्सव - अभिषेक <br>(श्री मंत्रार्थ मंडपम्)': {
		type: 'utsav',
		date: ['Jun 13, 2021', 'Jun 2, 2022'],
	},
	'श्री सरकार की जयंती': {
		type: 'utsav',
		date: ['Jun 14, 2021', 'Jun 3, 2022'],
	},
	'श्री लक्ष्मीनिधि जयंती': {
		type: 'utsav',
		date: ['Jun 15, 2021', 'Jun 4, 2022'],
	},
	'श्री महाराजजी का भण्डारा': {
		type: 'utsav',
		date: ['Jun 16, 2021', 'Jun 5, 2022'],
	},
	'श्रीसरयूजी की जयंती': {
		type: 'utsav',
		date: ['Jun 24, 2021', 'Jun 14, 2022'],
	},
	'श्रीसाकेतवासी महाराज जी की जयंती': {
		type: 'utsav',
		date: ['Jul 7, 2021', 'Jun 26, 2022'],
	},
	'रथ यात्रा': {
		type: 'utsav',
		date: ['Jul 12, 2021', 'Jul 1, 2022'],
	},
	'श्री गुरु पूर्णिमा': {
		type: 'utsav',
		date: ['Jul 24, 2021', 'Jul 13, 2022'],
	},
	'झूलनोत्सव<br>(साजा, छत्तीसगढ़ में)': {
		type: 'utsav',
		date: ['Jul 27, 2021', 'Jul 16, 2022'],
		enddate: ['Aug 4, 2021', 'Jul 26, 2022'],
	},
	'झूलनोत्सव<br>(श्री अयोध्याजी में)': {
		type: 'utsav',
		date: ['Aug 11, 2021', 'Jul 31, 2022'],
		enddate: ['Aug 22, 2021', 'Aug 11, 2022'],
	},
	'गो. तुलसीदास की जयंती': {
		type: 'utsav',
		date: ['Aug 15, 2021', 'Aug 04, 2022'],
	},
	'स्वरूप सम्मेलन': {
		type: 'utsav',
		date: ['Aug 20, 2021', 'Aug 10, 2022'],
	},
	'रक्षा बंधन': {
		type: 'utsav',
		date: ['Aug 22, 2021', 'Aug 11, 2022'],
	},
	'श्री कृष्ण जन्माष्टमी': {
		type: 'utsav',
		date: ['Aug 31, 2021', 'Aug 20, 2022'],
	},
	'श्री प्रेम रामायण जयंती': {
		type: 'utsav',
		date: ['Sep 14, 2021', 'Sep 03, 2022'],
	},
	'श्री बामन द्वादशी': {
		type: 'utsav',
		date: ['Sep 17, 2021', 'Sep 07, 2022'],
	},
	'बड़ा रविवार': {
		type: 'utsav',
		date: ['Sep 19, 2021', 'Sep 04, 2022'],
	},
	'श्री विजयादशमी': {
		type: 'utsav',
		date: ['Oct 15, 2021', 'Oct 05, 2022'],
	},
	'श्री शरद पूर्णिमा': {
		type: 'utsav',
		date: ['Oct 20, 2021', 'Oct 09, 2022'],
	},
	'श्री राम मंत्रानुष्ठान<br>(श्री अयोध्याजी में)': {
		type: 'utsav',
		date: ['Oct 20, 2021', 'Oct 09, 2022'],
		enddate: ['Oct 30, 2021', 'Oct 18, 2022'],
	},
	'सम्पूर्ण रामलीला<br>(श्री अयोध्याजी में)': {
		type: 'utsav',
		date: ['Oct 18, 2021', 'Oct 07, 2022'],
		enddate: ['Nov 19, 2021', 'Nov 08, 2022'],
	},
	'श्री हनुमान जयन्ती': {
		type: 'utsav',
		date: ['Nov 03, 2021', 'Oct 23, 2022'],
	},
	'श्री शुभ दीपावली': {
		type: 'utsav',
		date: ['Nov 04, 2021', 'Oct 24, 2022'],
	},
	'श्री अन्नकूट': {
		type: 'utsav',
		date: ['Nov 05, 2021', 'Oct 26, 2022'],
	},
	'भाई दूज(भ्रात द्वितीया)': {
		type: 'utsav',
		date: ['Nov 06, 2021', 'Oct 27, 2022'],
	},
	'श्री अक्षय नवमी': {
		type: 'utsav',
		date: ['Nov 13, 2021', 'Nov 02, 2022'],
	},
	'अयोध्या की चौदह कोशी परिक्रमा': {
		type: 'utsav',
		date: ['Nov 12, 2021', 'Nov 01, 2022'],
		label: ['१०.२२ बजे(दिन) के बाद', '१२.४८ बजे(रात्रि) के बाद'],
	},
	'श्रीसिद्धिसदन विहारी विहारिणी जू का विवाहोत्सव': {
		type: 'utsav',
		date: ['Nov 24, 2021', 'Nov 13, 2022'],
	},
	'श्री सीताराम विवाहोत्सव समैया - श्रीअयोध्या जी': {
		type: 'utsav',
		date: ['Dec 5, 2021', 'Nov 25, 2022'],
		enddate: ['Dec 10, 2021', 'Nov 30, 2022'],
	},
	'मकर संक्राति पुण्यकाल': {
		type: 'utsav',
		date: ['Jan 15, 2022', 'Jan 15, 2023'],
	},
	// 'पाटोत्सव - श्री अवधबिहारीबिहारिणीजू<br>(खेराकला कैलारस)': {
	// 	type: 'utsav',
	// 	date: ['Jan 21, 2022'],
	// 	enddate: ['Jan 23, 2022'],
	// },
	'श्री रामानन्दाचार्य जयंती': {
		type: 'utsav',
		date: ['Jan 24, 2022', 'Jan 14, 2023'],
	},
	'श्री स्वामी जी का भंडारा': {
		type: 'utsav',
		date: ['Feb 1, 2022', 'Jan 21, 2023'],
	},
	// 'श्रीजानकीजीवनलालजू का पाटोत्सव (साजा में)': {
	// 	type: 'utsav',
	// 	date: ['Feb 3, 2022'],
	// 	enddate: ['Feb 5, 2022'],
	// },
	'बसंत पंचमी': {
		type: 'utsav',
		date: ['Feb 05, 2022', 'Jan 26, 2023'],
	},
	// 'श्रीमिथिलाबिहारी विहारिणी जू का पाटोत्सव (शाहनगर)': {
	// 	type: 'utsav',
	// 	date: ['Feb 9, 2022'],
	// 	enddate: ['Feb 11, 2022'],
	// },
	// 'श्री विवाहमण्डपबिहारी बिहारिणीजू का पाटोत्सव (छत्तरपुर म.प्र.)': {
	// 	type: 'utsav',
	// 	date: ['Feb 16, 2022'],
	// 	enddate: ['Feb 18, 2022'],
	// },
	'श्री फागोत्सव': {
		type: 'utsav',
		date: ['Mar 18, 2022', 'Mar 08, 2023'],
	},
	'रंग पंचमी': {
		type: 'utsav',
		date: ['Mar 22, 2022', 'Mar 12, 2023'],
	},
}



var chartHtml = '';
var days = ['रवि', 'सोम', 'मंगल', 'बुध', 'गुरु', 'शुक्र', 'शनि'];
var sortedDates = {};
var sortedYears = new Set();
var arrMonths = ["जनवरी", "फ़रवरी", "मार्च", "अप्रैल", "मई", "जून", "जुलाई", "अगस्त", "सितम्बर", "अक्टूबर", "नवम्बर", "दिसम्बर"];
var arrDigits = ["०", "१", "२", "३", "४", "५", "६", "७", "८", "९"];
var recentFestivals = {};

function formatDate(date) {
	return replaceDigitsToHindi(`${date.getDate()} ${arrMonths[date.getMonth()]} ${date.getFullYear()}`);
}

function replaceDigitsToHindi(str) {
	return str.toString().replace(/./g, function(char) {
		return arrDigits[char] || char;
	});
}
function getNirnayHtml(isAskingRecent) {
	var today = new Date();
	today.setHours(0, 0, 0, 0); // today midnight
	var isNext;
	for(var itemName in finalDates) {
		var item = finalDates[itemName];
		item.enddate = item.enddate || [];
		item.label = item.label || [];
		if(item.date) {
			for(var index in item.date) {
				date = new Date(item.date[index]);
				sortedDates[date.getTime()] = sortedDates[date.getTime()] || [];
				sortedYears.add(date.getFullYear());
				sortedDates[date.getTime()].push({
					name: itemName,
					type: item.type,
					endDate: new Date(item.enddate[index] || item.date[index]),
					label: item.label[index],
				});
			}
		}
	}
	sortedYears = Array.from(sortedYears);
	sortedYears.sort();
	var sortedDatesKeys = Object.keys(sortedDates);
	sortedDatesKeys.sort();
	for(var year of sortedYears) {
		chartHtml += `<hr class="hr-text" data-content="${replaceDigitsToHindi(year)}"><div class="d-flex justify-content-center flex-wrap">`;
		for(var dateStamp of sortedDatesKeys) {
			var itemArr = sortedDates[dateStamp];
			for(var item of itemArr) {
				var itemDate = new Date(+dateStamp);
				var itemEndDate = item.endDate;
				var passedDate = itemEndDate < today ? ' disabled' : '';
				if(itemDate.getFullYear() == year) {
					var itemName = item.name;
					if(item.type == 'ekadashi') {
						itemName += ' एकादशी';
					}
					var itemDay = days[itemDate.getDay()];
					var upcomingDate = '';
					var dateString = formatDate(itemDate);
					var endDateString = formatDate(itemEndDate);
					var daysLeft = itemDate >= today ? Math.ceil((itemDate.getTime() - today.getTime()) / (1000 * 3600 * 24)) : -1;
					var daysArr = ['आज', 'कल', 'परसों']
					if (today >= itemDate && today <= itemEndDate) {
						daysLeft = 0;
					}
					if((!isNext || daysLeft == 1) && daysLeft >= 0 && daysLeft < 31) {
						upcomingDate = daysLeft != 0 ? ' bg-warning text-dark' : ' bg-info text-white';
						if(daysLeft > 0) {
							isNext = true;
						}
					}
					if(daysLeft > 2 && daysLeft < 31) {
						daysLeft += ' दिन बाद';
					} else {
						daysLeft = daysArr[daysLeft] || '';
					}
					if (daysLeft) {
						recentFestivals[itemName] = {day: daysLeft, date: `${dateString}${itemEndDate > itemDate ? ' से प्रारम्भ' : ''}`};
						daysLeft = `(${daysLeft})`;
						if (isAskingRecent && isNext) {
							return;
						}
					} else {
						daysLeft = '';
					}
					if (itemEndDate > itemDate) {
						chartHtml += `<div class='card text-center flat${upcomingDate}${passedDate}'>${itemName}<div class='text-dark'><small class='d-block'>${daysLeft}</small>${dateString} से<br>${endDateString} तक</div></div>`;
					} else {
						chartHtml += `<div class='card text-center flat${upcomingDate}${passedDate}'>${itemName}<div class='text-dark'><small class='d-block'>${daysLeft}</small>${dateString}<br>${item.label ? item.label : (itemDay + 'वार')}</div></div>`;
					}
				}
			}
		}
		chartHtml += `</div>`;
	}
	return chartHtml;
}

function getRecentFestivals() {
	getNirnayHtml(true);
	return recentFestivals;
}
