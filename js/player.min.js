var elms=["togglePlayer","plus10","minus10","audioPlayer","seektime","controlsInner","trackInfo","timer","duration","playBtn","pauseBtn","prevBtn","nextBtn","playlistBtn","volumeBtn","progress","bar","wave","loading","playlist","list","volume","barEmpty","barFull","sliderBtn","playerWindow","seekbar"];elms.forEach(function(e){window[e]=document.getElementById(e)});var Player=function(e){this.playlist=e,this.index=0,trackInfo.innerHTML="1. "+e[0].title};function toggleAudioPlayer(){$(playerWindow).toggleClass("mini"),$(togglePlayer).toggleClass("mini")}Player.prototype={play:function(e){var t,n=this;e="number"==typeof e?e:n.index;var i=n.playlist[e];(t=i.howl?i.howl:i.howl=new Howl({player:audioPlayer,src:i.file,duration:i.duration,html5:!0,onplay:function(){duration.innerHTML=n.formatTime(Math.round(t.duration())),requestAnimationFrame(n.step.bind(n)),wave.container.style.display="block",bar.style.display="none",pauseBtn.style.display="block",changeIcon(n.index)},onload:function(){wave.container.style.display="block",bar.style.display="none",loading.style.display="none"},onloading:function(){wave.container.style.display="none",loading.style.display="block",playBtn.style.display="none",pauseBtn.style.display="none",bar.style.display="block"},onplaying:function(){wave.container.style.display="block",loading.style.display="none",playBtn.style.display="none",pauseBtn.style.display="block",bar.style.display="none"},onend:function(){wave.container.style.display="none",bar.style.display="block",n.skip("next")},onpause:function(){playBtn.style.display="block",pauseBtn.style.display="none",wave.container.style.display="none",bar.style.display="block",changeIcon(n.index)},onstop:function(){wave.container.style.display="none",bar.style.display="block"},onseek:function(){requestAnimationFrame(n.step.bind(n))}})).play(),trackInfo.innerHTML=e+1+". "+i.title,"loaded"===t.state()?(playBtn.style.display="none",pauseBtn.style.display="block"):(loading.style.display="block",playBtn.style.display="none",pauseBtn.style.display="none"),n.index=e},pause:function(){this.playlist[this.index].howl.pause(),playBtn.style.display="block",pauseBtn.style.display="none"},skip:function(e){var t=0;"prev"===e?(t=this.index-1)<0&&(t=this.playlist.length-1):(t=this.index+1)>=this.playlist.length&&(t=0),this.skipTo(t)},skipTo:function(e){this.playlist[this.index].howl&&(this.playlist[this.index].howl.stop(),delete this.playlist[this.index].howl),progress.style.width="0%",isPlayerMouseDown||(seekbar.style.left=progress.style.width),this.play(e)},volume:function(e){Howler.volume(e);var t=90*e/100;barFull.style.width=100*t+"%",sliderBtn.style.left=window.innerWidth*t+.05*window.innerWidth-25+"px"},seek:function(e){var t=this.playlist[this.index].howl;t&&t.playing()&&t.seek(t.duration()*e)},forward10s:function(){this.seekTo(10)},backward10s:function(){this.seekTo(-10)},seekTo:function(e=10){var t=this.playlist[this.index].howl;if(t&&t.playing()){var n=(t.seek()||0)+e;n=e>=0?n:Math.max(0,n),t.seek(n),timer.innerHTML=this.formatTime(Math.round(n)),progress.style.width=(n/t.duration()*100||0)+"%",isPlayerMouseDown||(seekbar.style.left=progress.style.width)}},step:function(){var e=this.playlist[this.index].howl,t=e.seek()||0;timer.innerHTML=this.formatTime(Math.round(t)),progress.style.width=(t/e.duration()*100||0)+"%",isPlayerMouseDown||(seekbar.style.left=progress.style.width),e.playing()&&requestAnimationFrame(this.step.bind(this))},formatTime:function(e){var t=Math.floor(e/60)||0,n=e-60*t||0;return t+":"+(n<10?"0":"")+n}};var player=new Player(playlistItems),mapper={mouseup:"touchend",mousemove:"touchmove",mousedown:"touchstart",click:"touchend",touchend:"mouseup",touchmove:"mousemove",touchstart:"mousedown"};function touchMouse(e,t,n,i){var o=t.split(" ");for(var s of o)e.addEventListener(s,n),e.addEventListener(mapper[s],i||function(e){n(e),e.preventDefault()})}touchMouse(controlsInner,"mouseup mousemove mousedown",function(e){e.stopPropagation(),e.preventDefault()}),touchMouse(playBtn,"click",function(e){player.play()}),touchMouse(togglePlayer,"click",function(e){toggleAudioPlayer()}),touchMouse(pauseBtn,"click",function(e){player.pause()}),touchMouse(prevBtn,"click",function(e){player.skip("prev")}),touchMouse(nextBtn,"click",function(e){player.skip("next")}),touchMouse(minus10,"click",function(e){player.backward10s()}),touchMouse(plus10,"click",function(e){player.forward10s()});var currentSound,soundDuration,isPlayerMouseDown=!1,playerWidth=0,eventMap={mousedown:function(e){(currentSound=player.playlist[player.index].howl)&&currentSound.playing()&&(soundDuration=currentSound.duration(),isPlayerMouseDown=!0,playerWidth=window.innerWidth,seekbar.style.left=100*e/playerWidth+"%"),event.stopPropagation(),event.preventDefault()},mouseup:function(e){event.stopPropagation(),event.preventDefault(),isPlayerMouseDown&&(isPlayerMouseDown=!1,player.seek(e/window.innerWidth),currentSound.play(),seektime.style.display="none")},mousemove:function(e){if(isPlayerMouseDown){event.stopPropagation(),event.preventDefault(),seekbar.style.left=100*e/playerWidth+"%";var t=e/playerWidth;seektime.style.display="inline-block",t>.2?seektime.classList.add("to-right"):seektime.classList.remove("to-right"),seektime.innerHTML=player.formatTime(Math.round(t*soundDuration))}}};touchMouse(playerWindow,"mousedown mousemove mouseup",function(e,t){eventMap[e.type](e.clientX)},function(e){"touchend"==e.type?eventMap[mapper[e.type]](e.changedTouches[0].clientX):eventMap[mapper[e.type]](e.touches[0].clientX)});var wave=new SiriWave({container:waveform,width:window.innerWidth,height:.3*window.innerHeight,cover:!0,speed:.03,amplitude:.7,frequency:2});wave.start();var resize=function(){var e=.3*window.innerHeight,t=window.innerWidth;wave.height=e,wave.height_2=e/2,wave.MAX=wave.height_2-4,wave.width=t,wave.width_2=t/2,wave.width_4=t/4,wave.canvas.height=e,wave.canvas.width=t;var n=player.playlist[player.index].howl;if(n)n.volume()};window.addEventListener("resize",resize),resize();