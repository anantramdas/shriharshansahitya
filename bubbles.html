<html>
	<head>
		<title>HTML Game</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="js/jquery.min.js"></script>
		<style type="text/css">
			html, body {
				margin: 0;
				padding: 0;
				user-select: none;
				-webkit-tap-highlight-color: transparent;
			}
			@font-face {
			  font-family: kurale;
			  src: url(fonts/Kurale.ttf);
			}
			#frame {
				width: 100%;
				height: 100%;
				background-color: #222;
				font-family: kurale;
			}
			.node {
				position: fixed;
				display: flex;
				justify-content: center;
				align-items: center;
				font-size: 25px;
				font-weight: 500px;
				width: 60px;
				height: 60px;
				border-radius: 50%;
  				background-repeat: no-repeat;
				cursor: pointer;
			}
			#ans {
				position: fixed;
				top: 0;
				bottom: 0;
				right: 0;
				left: 0;
				display: flex;
				justify-content: center;
				align-items: center;
				color: #909090;
				font-family: kurale;
				font-size: 35px;
			}
			#startGame {
				width: 80px;
				height: 80px;
				border-radius: 10px;
			}
			.hidden {
				display: none;
				width: 100%;
			}
			.wrong {
				color: red !important;
			}
			.right {
				color: green !important;
			}
			.node {
				animation: goTop linear forwards;
				transition: opacity .5s;
			}
			.node.hide {
				opacity: 0;
			}
			.node.bg0{
				background: radial-gradient(#fff, #f8b500);
			}
			.node.bg1{
				background: radial-gradient(#fff, #f8b500);
			}
			.node.bg2{
				background: radial-gradient(#cfcfcf, #77c3ff);
			}
			.node.bg3{
				background: radial-gradient(#cfcfcf, #77c3ff);
			}
			#score {
				color: white;
			}
			#score, #timer, #output {
				display:block;
				text-align: center;
			}
			#timer {
				font-size: 20px;
			}
			@keyframes goTop {
				to {top: -100px;}
			}
		</style>
		<script type="text/javascript">
			var nid = 0, score = 0;
			var gems = ['सी', 'ता', 'रा', 'म'];
			var answer = '';
			var dividers, divides = [];
			var startTime, timer;
			function onBust(th, index) {
				var userAns = $("#output");
				if (answer == '') {
					userAns.removeClass("right");
				}
				answer += index;
				var ansHTML = '';
				for (const c of answer) {
					ansHTML += gems[c%4];
				}
				if (answer == '0123') {
					score++;
					$("#score").html(score);
					answer = '';
					userAns.addClass("right");
				}
				if (!"0123".startsWith(answer)) {
					userAns.addClass('wrong');
					answer = '';
				} else{
					userAns.removeClass('wrong');
				}
				userAns.html(ansHTML);
				$(th).addClass('hide');
			}
			function shuffle(array) {
				let counter = array.length;
				while (counter > 0) {
					let index = Math.floor(Math.random() * counter);
					counter--;
					let temp = array[counter];
					array[counter] = array[index];
					array[index] = temp;
				}
				return array;
			}
			function createNode() {
				var h = $(window).height();
				var top = h * 2 / 3 + Math.floor((Math.random() * h / 3));
				var duration = 10 * top/h;
				var index = nid%4;
				if (divides.length == 0) {
					dividers = parseInt($(window).width() / 60);
					divides = Array.from(Array(dividers).keys());
					divides = shuffle(divides);
				}
				var left = divides.pop() * 60;
				$('#frame').append( `<div id='node${nid}' class='node bg${index}' onclick='onBust(this, ${index})' style='animation-duration:${duration}s;top:${top}px;left:${left}px;' z-index=${nid}>${gems[index]}</div>` );
				setTimeout(removeMe,duration * 1000, nid);
				nid++;
			}
			function removeMe(nodeId) {
				$('#node'+nodeId).remove();
			}
			function onStart() {
				$("#startGame").hide();
				startTime = new Date();
				timer = $("#timer");
				$(".hidden").show();
				setInterval(createNode, 700);
				setInterval(updateTimer, 1000);
			}
			function updateTimer() {
				var now = new Date().getTime();
				var distance = now - startTime;

				// Time calculations for days, hours, minutes and seconds
				// var days = Math.floor(distance / (1000 * 60 * 60 * 24));
				var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
				var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
				var seconds = Math.floor((distance % (1000 * 60)) / 1000);

				timer.html(hours + "h "
				+ minutes + "m " + seconds + "s ");
			}
		</script>
	</head>
	<body>
		<div id="ans">
			<div class="hidden">
				<span id="output"><br></span>
				<span id="score">0</span>
				<span id="timer"></span>
			</div>
			<button id="startGame" onclick="onStart()">Play</button>
			</div>
		</div>
		<div id="frame">
		</div>
	</body>
</html>